{% extends "Ecommerce/base.html" %}
{% load static %}
{% block content %}



<link rel="stylesheet" href="{% static 'Ecommerce/cart.css' %}">

<div class="cart-container">

    <div class="cart-header">
        {% if cart_items %}
        <table class="cart-table">
            <thead>
                <tr>
                    <th></th>
                    <th>Product</th>
                    <th>Variant</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for item in cart_items %}
                <tr data-cart-item="{{ item.cart_item_id }}">
                    <td>
                        <a href="{% url 'Ecommerce:product_view' item.product_variant.product.product_id %}">
                            <img src="{{ item.product_variant.product.product_image.url }}" 
                                alt="{{ item.product_variant.product.product_name }}" 
                                class="cart-product-image">
                        </a>
                    </td>
                    <td>
                        <a href="{% url 'Ecommerce:product_view' item.product_variant.product.product_id %}">
                            {{ item.product_variant.product.product_name }}
                        </a>
                    </td>

                    <td>
                        <form method="post" action="{% url 'Ecommerce:update_variant' item.cart_item_id %}">
                            {% csrf_token %}
                            <select name="variant_id" onchange="this.form.submit()">
                                {% for variant in item.product_variant.product.productvariant_set.all %}
                                <option value="{{ variant.variant_id }}" 
                                        {% if variant.variant_id == item.product_variant.variant_id %}selected{% endif %}>
                                    {{ variant.units }} 
                                </option>
                                {% endfor %}
                            </select>
                        </form> 
                    </td>
                    <td>
                        <!-- Quantity increase decrease -->
                        <div class="quantity-selector">
                            <!-- Decrease Button -->
                            <form method="post" action="{% url 'Ecommerce:decrease_quantity' %}">
                                {% csrf_token %}
                                <input type="hidden" name="item_id" value="{{ item.cart_item_id }}">
                                <button type="submit" class="decrease">-</button>
                            </form>
                    
                            <input type="text" class="quantity" value="{{ item.quantity }}" readonly>
                    
                            <!-- Increase Button -->
                            <form method="post" action="{% url 'Ecommerce:increase_quantity' %}">
                                {% csrf_token %}
                                <input type="hidden" name="item_id" value="{{ item.cart_item_id }}">
                                <button type="submit" class="increase">+</button>
                               
                            </form>
                        </div>
                    </td>
                    <td>
                        <p class="price">₹<span class="price-display" id="price-{{ item.cart_item_id }}">{{ item.total_price }}</span></p>
                    </td>
                    <td>
                        <a href="{% url 'Ecommerce:remove_from_cart' item.cart_item_id %}">
                            <button class="remove-cart" data-item-id="{{ item.cart_item_id }}">Remove</button>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="cart-footer">
        <p class="grand-total">Total: ₹<span id="grand-total">{{ grand_total }}</span></p>
        <a href="{% url 'Ecommerce:checkout' %}" class="checkout-btn">Checkout</a>
    </div>

    {% else %}
    <p class="empty-cart-message">Your cart is empty.</p>
    <div class="cart-footer back-btn">
        <a href="{% url 'Ecommerce:homepage' %}" class="back">Back to Home</a>
    </div>
    {% endif %}
</div> 




{% endblock %}
